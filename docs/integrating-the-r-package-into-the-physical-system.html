<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Dashboards project</title>
  <meta name="description" content="A guide to authoring books with R Markdown, including how to generate figures and tables, and insert cross-references, citations, HTML widgets, and Shiny apps in R Markdown. The book can be exported to HTML, PDF, and e-books (e.g. EPUB). The book style is customizable. You can easily write and preview the book in RStudio IDE or other editors, and host the book wherever you want (e.g. bookdown.org).">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Dashboards project" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://folkehelseinstituttet.github.io/dashboards/" />
  <meta property="og:image" content="https://folkehelseinstituttet.github.io/dashboards/images/fhi.svg" />
  <meta property="og:description" content="A guide to authoring books with R Markdown, including how to generate figures and tables, and insert cross-references, citations, HTML widgets, and Shiny apps in R Markdown. The book can be exported to HTML, PDF, and e-books (e.g. EPUB). The book style is customizable. You can easily write and preview the book in RStudio IDE or other editors, and host the book wherever you want (e.g. bookdown.org)." />
  <meta name="github-repo" content="folkehelseinstituttet/dashboards" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Dashboards project" />
  
  <meta name="twitter:description" content="A guide to authoring books with R Markdown, including how to generate figures and tables, and insert cross-references, citations, HTML widgets, and Shiny apps in R Markdown. The book can be exported to HTML, PDF, and e-books (e.g. EPUB). The book style is customizable. You can easily write and preview the book in RStudio IDE or other editors, and host the book wherever you want (e.g. bookdown.org)." />
  <meta name="twitter:image" content="https://folkehelseinstituttet.github.io/dashboards/images/fhi.svg" />

<meta name="author" content="Richard White">


<meta name="date" content="2018-11-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="r-packages.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Dashboards</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#executive-summary"><i class="fa fa-check"></i><b>1.1</b> Executive summary</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#what-is-an-automated-analysis"><i class="fa fa-check"></i><b>1.2</b> What is an automated analysis?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-not-have-one-project-for-each-automated-analysis"><i class="fa fa-check"></i><b>1.3</b> Why not have one project for each automated analysis?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#important-repositories"><i class="fa fa-check"></i><b>1.4</b> Important repositories</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#infrastructure"><i class="fa fa-check"></i><b>1.4.1</b> Infrastructure</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#automated-analyses-r-packages"><i class="fa fa-check"></i><b>1.4.2</b> Automated analyses R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html"><i class="fa fa-check"></i><b>2</b> Integrating the R package into the physical system</a><ul>
<li class="chapter" data-level="2.1" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#summary"><i class="fa fa-check"></i><b>2.1</b> Summary</a></li>
<li class="chapter" data-level="2.2" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#runprocess.r"><i class="fa fa-check"></i><b>2.2</b> RunProcess.R</a><ul>
<li class="chapter" data-level="2.2.1" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#aim"><i class="fa fa-check"></i><b>2.2.1</b> Aim</a></li>
<li class="chapter" data-level="2.2.2" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#bounded-context"><i class="fa fa-check"></i><b>2.2.2</b> Bounded context</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#run.sh"><i class="fa fa-check"></i><b>2.3</b> 0_run.sh</a><ul>
<li class="chapter" data-level="2.3.1" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#aim-1"><i class="fa fa-check"></i><b>2.3.1</b> Aim</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#runtest.r"><i class="fa fa-check"></i><b>2.4</b> RunTest.R</a><ul>
<li class="chapter" data-level="2.4.1" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#aim-2"><i class="fa fa-check"></i><b>2.4.1</b> Aim</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-packages.html"><a href="r-packages.html"><i class="fa fa-check"></i><b>3</b> R packages</a><ul>
<li class="chapter" data-level="3.1" data-path="r-packages.html"><a href="r-packages.html#summary-1"><i class="fa fa-check"></i><b>3.1</b> Summary</a></li>
<li class="chapter" data-level="3.2" data-path="r-packages.html"><a href="r-packages.html#requirements"><i class="fa fa-check"></i><b>3.2</b> Requirements</a></li>
<li class="chapter" data-level="3.3" data-path="r-packages.html"><a href="r-packages.html#deployment-via-travis-ci-and-drat"><i class="fa fa-check"></i><b>3.3</b> Deployment via travis-ci and drat</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html"><i class="fa fa-check"></i><b>4</b> Umbrella Infrastructure</a><ul>
<li class="chapter" data-level="4.1" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#executive-summary-1"><i class="fa fa-check"></i><b>4.1</b> Executive summary</a></li>
<li class="chapter" data-level="4.2" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#what-is-an-automated-analysis-1"><i class="fa fa-check"></i><b>4.2</b> What is an automated analysis?</a></li>
<li class="chapter" data-level="4.3" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#why-not-have-one-project-for-each-automated-analysis-1"><i class="fa fa-check"></i><b>4.3</b> Why not have one project for each automated analysis?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="contributing.html"><a href="contributing.html"><i class="fa fa-check"></i><b>5</b> Contributing</a><ul>
<li class="chapter" data-level="5.1" data-path="contributing.html"><a href="contributing.html#development-guidelines"><i class="fa fa-check"></i><b>5.1</b> Development guidelines</a></li>
<li class="chapter" data-level="5.2" data-path="contributing.html"><a href="contributing.html#code-style"><i class="fa fa-check"></i><b>5.2</b> Code style</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="manual-actions.html"><a href="manual-actions.html"><i class="fa fa-check"></i><b>6</b> Manual Actions</a><ul>
<li class="chapter" data-level="6.1" data-path="manual-actions.html"><a href="manual-actions.html#sykdomspulsen"><i class="fa fa-check"></i><b>6.1</b> Sykdomspulsen</a><ul>
<li class="chapter" data-level="6.1.1" data-path="manual-actions.html"><a href="manual-actions.html#sykdomspulsen-weekly-update"><i class="fa fa-check"></i><b>6.1.1</b> Sykdomspulsen Weekly update</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Dashboards project</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="integrating-the-r-package-into-the-physical-system" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Integrating the R package into the physical system</h1>
<div id="summary" class="section level2">
<h2><span class="header-section-number">2.1</span> Summary</h2>
<p>An R package is not enough to run an analysis – something needs to physically call the functions inside the R package. That is, the R package needs to be integrated into the physical system.</p>
<p>Everything related to integrating the R package into the physical system lives in the <a href="https://github.com/folkehelseinstituttet/dashboards/">dashboards</a> repository.</p>
<p>Inside the <a href="https://github.com/folkehelseinstituttet/dashboards/">dashboards</a> repository we have:</p>
<pre><code>- dev/
  |-- src/
    |-- sykdomspuls/
       |-- 0_run.sh
       |-- RunProcess.R
       |-- RunTest.R
    |-- normomo/
       |-- 0_run.sh
       |-- RunProcess.R
       |-- RunTest.R
    |-- sykdomspuls_log/
       |-- 0_run.sh
       |-- RunProcess.R
       |-- RunTest.R
    |-- sykdomspuls_pdf/
       |-- 0_run.sh
       |-- RunProcess.R
       |-- RunTest.R</code></pre>
</div>
<div id="runprocess.r" class="section level2">
<h2><span class="header-section-number">2.2</span> RunProcess.R</h2>
<div id="aim" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Aim</h3>
<p>An automated analysis needs to:</p>
<ol style="list-style-type: decimal">
<li>Know the location of the data/results folders.</li>
<li>Check for new data in these folders. If no new data - then quit.</li>
<li>Load in the data.</li>
<li>Load in the analysis functions.</li>
<li>Run the analyses.</li>
<li>Save the results.</li>
</ol>
<p><code>RunProcess.R</code> is responsible for these tasks.</p>
<p>We can think of it as an extremely short and extremely high-level script that implements the analysis scripts.</p>
<p>Depending on the automated analysis <code>RunProcess.R</code> can be run every two minutes (constantly checking for new data), or once a week (when we know that data will only be available on a certain day/time).</p>
</div>
<div id="bounded-context" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Bounded context</h3>
<ol style="list-style-type: decimal">
<li>Only one instance of <code>RunProcess.R</code> can be run at a time.</li>
<li>Data only exists on physical folders on the system.</li>
<li>The following folder structure exists on the system (here the name of the automated analysis is <code>ANALYSIS</code>):</li>
</ol>
<pre><code>/data_raw/
  |-- ANALYSIS/
/data_clean/
  |-- ANALYSIS/
/data_app/
  |-- ANALYSIS/
/results/
  |-- ANALYSIS/
/src/
  |-- ANALYSIS/
     |-- 0_run.sh
     |-- RunProcess.R
     |-- RunTest.R</code></pre>
<p>Point #1 is important because if <code>RunProcess.R</code> is run every 2 minutes (constantly checking for new data) but the analyses take 3 hours to run, then we need to ensure that only one instance of <code>RunProcess.R</code> can be run at a time.</p>
<p>Point #2 is important because sometimes:</p>
<ol style="list-style-type: decimal">
<li>Data files need to be downloaded from external SFTP servers (<a href="https://folkehelseinstituttet.github.io/dashboards_normomo/">normomo</a>, <a href="https://folkehelseinstituttet.github.io/dashboards_sykdomspuls_log/">sykdomspulslog</a>).</li>
<li>Results files need to be uploaded to external SFTP servers (<a href="https://folkehelseinstituttet.github.io/dashboards_sykdomspuls/">sykdomspuls</a>).</li>
</ol>
<p>If we include code to download/upload the files from SFTP servers inside <code>RunProcess.R</code> then it makes it very difficult to test <code>RunProcess.R</code> (because we will then need to simulate SFTP servers inside our testing infrastructure). If we know that <code>RunProcess.R</code> only accesses files that are available on physical folders in the system, then our testing infrastructure is a lot easier to create and maintain.</p>
</div>
</div>
<div id="run.sh" class="section level2">
<h2><span class="header-section-number">2.3</span> 0_run.sh</h2>
<div id="aim-1" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Aim</h3>
<p>The aim of <code>0_run.sh</code> is to ensure that:</p>
<ol style="list-style-type: decimal">
<li>Points 1 and 2 of the bounded context of <code>RunProcess.R</code> happen</li>
<li>Run <code>RunProcess.R</code></li>
</ol>
<p>With regards to the bounded context, we ensure that only one instance of <code>RunProcess.R</code> is run at a time through the use of <code>flock</code>.</p>
<p>(If neccessary) with regards to the bounded context, we use <code>sshpass</code>, <code>sftp</code>, and <code>ncftpput</code> to download/upload files from SFTP servers.</p>
<p>We then run <code>RunProcess.R</code> with a standard call:</p>
<pre><code>/usr/local/bin/Rscript /src/ANALYSIS/RunProcess.R</code></pre>
</div>
</div>
<div id="runtest.r" class="section level2">
<h2><span class="header-section-number">2.4</span> RunTest.R</h2>
<div id="aim-2" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Aim</h3>
<p>The aim of <code>RunTest.R</code> is to perform integration testing on the automated analysis. This integration testing is performed as part of the Jenkins build pipeline.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["website.pdf", "website.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
